var Kaya=window.Kaya=function(){};Kaya.version="0.0.1",Kaya.debug=1;var uniqueIdNumber=0;Kaya.uniqueId=function(){return++uniqueIdNumber},Kaya.Utilities={extend:function(t){var i=Array.prototype.slice.call(arguments,1);return i.forEach(function(i){if(i)for(var e in i)t[e]=i[e]}),t},clone:function(t){if("object"!=typeof t)return t;var i;if(t instanceof Date)return i=new Date,i.setTime(t.getTime()),i;if(t instanceof Array)return i=Array.prototype.slice.call(t);if(t instanceof Object)return i=Kaya.Utilities.extend({},t);throw new Error("Failed to clone an object.")},hexToRgb:function(t){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(i,function(t,i,e,n){return i+i+e+e+n+n});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},rgbToHex:function(t,i,e){function n(t){t>255&&(t=255);var i=t.toString(16);return 1==i.length?"0"+i:i}return"#"+n(t)+n(i)+n(e)},bezier:function(t,i,e,n,s){var r=function(i){var n=1-i;return 3*n*n*i*t+3*n*i*i*e+i*i*i},a=function(t){var e=1-t;return 3*e*e*t*i+3*e*t*t*n+t*t*t};return function(t){var i,e,n,h,o=t;if(i=0,e=1,n=o,i>n)return a(i);if(n>e)return a(e);for(;e>i;){if(h=r(n),Math.abs(h-o)<s)return a(n);o>h?i=n:e=n,n=.5*(e-i)+i}return a(n)}},shuffle:function(t){for(var i,e,n=t.length;n;i=parseInt(Math.random()*n),e=t[--n],t[n]=t[i],t[i]=e);return t}};var initializingClass=!1;Kaya.Class=function(){},Kaya.Class.extend=function(t){function i(){initializingClass||(this._id=Kaya.uniqueId(),this.constructor&&this.constructor.apply(this,arguments))}var e=/\b_super\b/,n=this.prototype;initializingClass=!0;var s=new this;initializingClass=!1;for(var r in t)s[r]="function"==typeof t[r]&&"function"==typeof n[r]&&e.test(t[r])?function(t,i){return function(){var e=this._super;this._super=n[t];var s=i.apply(this,arguments);return this._super=e,s}}(r,t[r]):t[r];return i.prototype=s,i.extend=Kaya.Class.extend,i.join=Kaya.Class.join,i},Kaya.Event=Kaya.Class.extend({constructor:function(t,i,e,n){this.self=t,this.target=i,this.name=e,this.handler=n,i.addListener(this),t.addListening(this)},trigger:function(t){t.splice(0,0,this),this.handler.apply(this.self,t)},remove:function(){this.self.removeListening(this._id),this.target.removeListener(this._id)}});var EventMethods={addListener:function(t){this._events=this._events||[],this._events.push(t)},removeListener:function(t){if(this._events)for(var i in this._events)if(this._events[i]._id===t)return this._events.splice(i,1),void 0;throw new Error("Event not found when trying to remove it.")},addListening:function(t){this._listening=this._listening||[],this._listening.push(t)},removeListening:function(t){if(this._listening)for(var i in this._listening)if(this._listening[i]._id===t)return this._listening.splice(i,1),void 0;throw new Error("Event not found when trying to remove it.")},on:function(t,i){return new Kaya.Event(this,this,t,i),this},once:function(t,i){var e=function(t){i.apply(this,arguments),t.remove()};return this.on(t,e),this},off:function(){for(var t in arguments)if("string"==typeof arguments[t])var i=arguments[t];else if("function"==typeof arguments[t])var e=arguments[t];else if("object"==typeof arguments[t])var n=arguments[t];return this._events&&this._events.forEach(function(t){i&&t.name!==i||e&&t.handler!==e||n&&t.self!==n||t.remove()}),this},listenTo:function(t,i,e){return new Kaya.Event(this,t,i,e),this},listenToOnce:function(t,i,e){var n=function(t){e.apply(this,arguments),t.remove()};return this.listenTo(t,i,n),this},stopListening:function(){for(var t in arguments)if("string"==typeof arguments[t])var i=arguments[t];else if("function"==typeof arguments[t])var e=arguments[t];else if("object"==typeof arguments[t])var n=arguments[t];this._listening&&this._listening.forEach(function(t){i&&t.name!==i||e&&t.handler!==e||n&&t.target!==n||t.remove()})},trigger:function(t){var i=Array.prototype.slice.call(arguments);if(i.splice(0,1),this._events)for(var e in this._events)this._events[e].name===t&&this._events[e].trigger(i);return this}};Kaya.Object=Kaya.Class.extend({get:function(t){return this._properties?t?"undefined"==typeof this._properties[t]?void 0:this._properties[t]:Kaya.Utilities.clone(this._properties):void 0},_checkDataType:function(t,i){switch(this.dataTypes?this.dataTypes[t]||"":""){case"Integer":return parseInt(i);case"Float":return parseFloat(i);case"String":return String(i);default:return i}},set:function(){var t,i=!1;"string"==typeof arguments[0]&&"undefined"!=typeof arguments[1]?(t={},t[arguments[0]]=arguments[1],arguments[2]&&(i=!0)):"object"==typeof arguments[0]&&(t=arguments[0],arguments[1]&&(i=!0)),this._properties=this._properties||{},this._previous=this._previous||{};var e={},n=!1;for(var s in t)t.hasOwnProperty(s)&&(t[s]=this._checkDataType(s,t[s]),("undefined"===this.get(s)||this.get(s)!==t[s])&&(this._previous[s]=this._properties[s],this._properties[s]=t[s],e[s]=t[s],n=!0));if(n&&(this._changes=e,!i)){this.trigger("change");for(var s in e)this.trigger("change:"+s)}return this},unset:function(t,i){return this._properties&&this._properties.hasOwnProperty(t)&&(this._previous[t]=this._properties[t],delete this._properties[t],i||(this.trigger("change"),this._changes=[].push(t))),this},previous:function(t){return this._previous?t?this._previous[t]||void 0:Kaya.Utilities.clone(this._previous):void 0},hasChanged:function(t){return this._changes&&"undefined"!=typeof this._changes[t]},changes:function(){return Kaya.Utilities.clone(this._changes)}}),Kaya.Utilities.extend(Kaya.Object.prototype,EventMethods),Kaya.Schedule=Kaya.Class.extend({constructor:function(t,i,e){this.self=t,this.interval=e,this.handler=i,this.timer=0},refresh:function(t){if(this.timer+=t,this.timer>=this.interval)if(this.handler.call(this.self,this,t),this.interval)for(;this.timer>=this.interval;)this.timer-=this.interval;else this.timer=0},remove:function(){this.self.removeSchedule(this)}}),ScheduleMethods={setSchedule:function(t,i){this._schedules=this._schedules||[],this._schedules.push(new Kaya.Schedule(this,t,i))},removeSchedule:function(t){if(t){var i=this._schedules.indexOf(t);if(!(i>-1))throw new Error("Unable to remove schedule: id not exist.");this._schedules.splice(i,1)}else this._schedules&&(this._schedules.length=0)}},Kaya.Interaction=Kaya.Class.extend(),Kaya.Interaction.TouchEvent=Kaya.Class.extend({constructor:function(t){var i=this;this.app=t,this.touchObject=document.createElement("div"),this.touchObject.style.position="absolute",this.touchObject.style.width=t.size.width+"px",this.touchObject.style.height=t.size.height+"px",this.touchObject.style.backgroundColor="#000",this.touchObject.style.opacity=0,this.touchObject.style.zIndex=1e3,this.app.DOM.childNodes.length?this.app.DOM.insertBefore(this.touchObject,this.app.DOM.childNodes[0]):this.app.DOM.appendChild(this.touchObject),this.touchObject.addEventListener("mousemove",function(t){i.mouseMove.call(i,t)}),this.touchObject.addEventListener("mousedown",function(t){i.mouseDown.call(i,t)}),this.touchObject.addEventListener("touchstart",function(t){i.touchHandler.call(i,t)})},mouseMove:function(t){var i={x:t.offsetX||t.layerX,y:t.offsetY||t.layerY};this.app.trigger("mouseMove",i)},mouseDown:function(t){var i={status:"start",x:t.offsetX||t.layerX,y:t.offsetY||t.layerY};this.app.trigger("touchEvent",i)},touchHandler:function(){console.log("handle touch event.")}}),Kaya.Resources=Kaya.Class.extend({constructor:function(t,i){this.app=t;var e=i.images;this.imagesToLoad=e.length,this._images={};for(var n in e)e.hasOwnProperty(n)&&(this._images[e[n]]=this.loadImage(e[n],this.imageLoaded.bind(this)))},loadImage:function(t,i){var e=new Image;return e.onload=i,e.src=t,e},imageLoaded:function(){this.imagesToLoad--,0===this.imagesToLoad&&(console.log("All images are loaded."),this.app.run())},images:function(t){return this._images[t]}}),Kaya.App=Kaya.Object.extend({constructor:function(){var t=this;if(!this.documentObject)throw new Error("No app frame is specified.");if(this.DOM=document.querySelector(this.documentObject),null===this.DOM)throw new Error("App document object is not found.");this.size=this.size||{},this.size.width=this.size.width||400,this.size.height=this.size.height||300,this.DOM.style.backgroundColor=this.background||"#000000",this.DOM.style.width=this.size.width+"px",this.DOM.style.height=this.size.height+"px",this.touchEvent=new Kaya.Interaction.TouchEvent(this),this.on("touchEvent",this.touchEventHandler),this.on("mouseMove",this.mouseMoveHandler),this.on("refresh",this.refresh),window.mozRequestAnimationFrame&&(window.requestAnimationFrame=mozRequestAnimationFrame),window.webkitRequestAnimationFrame&&(window.requestAnimationFrame=webkitRequestAnimationFrame);var i,e=function(){if(requestAnimationFrame(e,t.DOM),!i)return i=(new Date).getTime(),void 0;var n=(new Date).getTime(),s=n-i;i=n,t.trigger("refresh",s)};e(),this.resources?(this.resourcesList=this.resources,this.resources=new Kaya.Resources(this,this.resourcesList)):this.run()},run:function(){this.initialize&&this.initialize.call(this)},touchEventHandler:function(t,i){this.currentStage&&this.currentStage.trigger("touchEvent",i)},mouseMoveHandler:function(t,i){this.currentStage&&this.currentStage.trigger("mouseMove",i)},refresh:function(t,i){document.querySelector("#fps").innerHTML=Math.round(1e4/i)/10,this.currentStage&&this.currentStage.trigger("refresh",i)},runStage:function(t){this.currentStage&&this.currentStage.remove(),t.run(this),this.currentStage=t}}),Kaya.Stage=Kaya.Object.extend({constructor:function(){this._layers=[],this.on("refresh",this.refresh),this.on("touchEvent",this.touchEventHandler),this.on("mouseMove",this.mouseMoveHandler)},run:function(t){this.app=t,this.createDOM(),this.initialize&&this.initialize.call(this)},createDOM:function(){if(!this.app||!this.app.DOM)throw new Error("Unable to create DOM");this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.app.size.width,this.canvas.height=this.app.size.height,this.app.DOM.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},removeDOM:function(){this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.canvas)},attach:function(t){if("undefined"!=typeof t.parent)throw new Error("Unable to attach layer: the layer is already attached to a stage");this.detach(t._id),t.run(this),this._layers.push(t)},detach:function(t){var i;return(i=this._layers.indexOf(t))>-1?(delete t.parent,this._layers.splice(i,1),!0):!1},eachLayer:function(t){this._layers.forEach(t,this)},refresh:function(t,i){this.eachLayer(function(t){t.trigger("refresh",i)});var e=this.context;e.clearRect(0,0,this.app.size.width,this.app.size.width),this.eachLayer(function(t){e.drawImage(t.canvas,0,0)})},touchEventHandler:function(t,i){this.eachLayer(function(t){t.trigger("touchEvent",i)})},mouseMoveHandler:function(t,i){this.eachLayer(function(t){t.trigger("mouseMove",i)})},remove:function(){this.removeDOM(),this.off(),this.stopListening(),console.log("stage is removed.")}}),Kaya.Layer=Kaya.Object.extend({constructor:function(){this._children=[],this.changed=!1,this.on("refresh",this.refresh),this.on("touchEvent",this.touchEventHandler),this.on("mouseMove",this.mouseMoveHandler)},run:function(t){var i=this;this.parent=t,this.app=t.app,this.createCanvas(),this.changed=!0,this.eachChild(function(t){t.run(i)}),this.initialize&&this.initialize.call(this)},createCanvas:function(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.app.size.width,this.canvas.height=this.app.size.height),this.context=this.canvas.getContext("2d")},attach:function(t){if("undefined"!=typeof t.parent)throw new Error("Unable to attach child: it has been attached.");this.detach(t._id),this.listenTo(t,"change",this.change),this.parent&&t.run(this),this._children.push(t)},detach:function(t){var i;return(i=this._children.indexOf(t))>-1?(delete t.parent,this.stopListening(t),this._children.splice(i,1),!0):!1},childById:function(t){return this._children[t]},eachChild:function(t){this._children.forEach(t,this)},filter:function(t){return this._children.filter(t)},where:function(t){return this.filter(function(i){if("undefined"!=typeof t)for(var e in t)if(t.hasOwnProperty(e)&&i.get(e)!==t[e])return!1;return!0})},touchEventHandler:function(t,i){this.eachChild(function(t){t.trigger("touchEvent",i)})},mouseMoveHandler:function(t,i){this.eachChild(function(t){t.trigger("mouseMove",i)})},change:function(){this.changed=!0},refresh:function(t,i){this._schedules&&this._schedules.forEach(function(t){t.refresh(i)},this),this.eachChild(function(t){t.trigger("refresh",i)}),this.changed&&(this.changed=!1,this.context.clearRect(0,0,this.app.size.width,this.app.size.width),this.eachChild(function(t){t.trigger("render")}))},remove:function(){this.parent&&this.parent.detach(this),this.off(),this.stopListening()}}),Kaya.Utilities.extend(Kaya.Layer.prototype,ScheduleMethods),Kaya.Sprite=Kaya.Object.extend({constructor:function(t){t.hover=!1,this.set(t),this.on("refresh",this.refresh),this.on("render",this.renderWrapper),this.on("touchEvent",this.touchEventHandler),this.on("mouseMove",this.mouseMoveHandler)},run:function(t){this.layer=t,this.app=t.app,this.context=t.context,this.initialize&&this.initialize.call(this),this.trigger("render")},render:function(){},renderWrapper:function(t,i){this.context.save(),this.context.translate(this.get("x"),this.get("y")),i?i.call(this):this.render(),this.context.restore()},touchEventHandler:function(t,i){return this.isOver(i)?(i.offsetX=i.x-this.get("x"),i.offsetY=i.y-this.get("y"),this.trigger("touch",i),!0):!1},mouseMoveHandler:function(t,i){this.set("hover",this.isOver(i))},isOver:function(){return!1},refresh:function(t,i){this._schedules&&this._schedules.forEach(function(t){t.refresh(i)},this),this._action&&this._action.refresh(i)},runAction:function(t,i){return t.direct=!0,this._action=t,i?t.run(this,i):t.run(this),this},finishAction:function(){delete this._action},remove:function(){this.layer&&this.layer.detach(this),this.off(),this.stopListening()}}),Kaya.Utilities.extend(Kaya.Sprite.prototype,ScheduleMethods),Kaya.Sprite.Text=Kaya.Sprite.extend({dataTypes:{text:"String",x:"Float",y:"Float",font:"String"},render:function(){this._super();var t=Kaya.Utilities.hexToRgb(this.get("color")),i="undefined"==typeof this.get("alpha")?1:this.get("alpha");this.context.fillStyle="rgba("+t.r+","+t.g+","+t.b+","+i+")",this.context.font=this.get("size")+"px "+this.get("font"),this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(this.get("text"),0,0),this.actualWidth=this.context.measureText(this.get("text")).width},isOver:function(t){return 2*Math.abs(this.get("x")-t.x)<this.actualWidth&&2*Math.abs(this.get("y")-t.y)<this.get("size")}}),Kaya.Sprite.Image=Kaya.Sprite.extend({dataTypes:{x:"Float",y:"Float",width:"Float",height:"Float",file:"String",hoverFile:"String"},render:function(){this._super(),"undefined"!=typeof this.get("rotate")&&this.context.rotate(this.get("rotate")),void 0!==this.get("alpha")&&(this.context.globalAlpha=this.get("alpha"));var t=this.get("width"),i=this.get("height");this.get("hoverFile")&&this.get("hover")?this.context.drawImage(this.app.resources.images(this.get("hoverFile")),-t/2,-i/2,t,i):this.context.drawImage(this.app.resources.images(this.get("file")),-t/2,-i/2,t,i)},isOver:function(t){var i=this.get("hoverWidth")||this.get("width"),e=this.get("hoverHeight")||this.get("height");return 2*Math.abs(this.get("x")-t.x)<=i&&2*Math.abs(this.get("y")-t.y)<=e}}),Kaya.Sprite.Rectangular=Kaya.Sprite.extend({dataTypes:{x:"Float",y:"Float",width:"Float",height:"Float",rotate:"Float",alpha:"Float",color:"Color"},render:function(){this._super(),"undefined"!=typeof this.get("rotate")&&this.context.rotate(this.get("rotate"));var t=Kaya.Utilities.hexToRgb(this.get("color")),i="undefined"==typeof this.get("alpha")?1:this.get("alpha");this.context.fillStyle="rgba("+t.r+","+t.g+","+t.b+","+i+")",this.context.fillRect(-this.get("width")/2,-this.get("height")/2,this.get("width"),this.get("height"))},isOver:function(t){return 2*Math.abs(this.get("x")-t.x)<=this.get("width")&&2*Math.abs(this.get("y")-t.y)<=this.get("height")}}),Kaya.Sprite.Circle=Kaya.Sprite.extend({dataTypes:{x:"Float",y:"Float",radius:"Float",alpha:"Float",color:"Color"},render:function(){this._super();var t=Kaya.Utilities.hexToRgb(this.get("color")),i="undefined"==typeof this.get("alpha")?1:this.get("alpha");this.context.fillStyle="rgba("+t.r+","+t.g+","+t.b+","+i+")",this.context.beginPath(),this.context.arc(0,0,this.get("radius"),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()}}),Kaya.Action=Kaya.Class.extend({constructor:function(){this._running=!1},run:function(t,i){this.sprite=t,i&&(this.callback=i),this._running=!0},refresh:function(t){this._running&&this._schedules&&this._schedules.forEach(function(i){i.refresh(t)},this)},_finish:function(){this.callback&&this.callback.call(this.sprite),this.removeSchedule(),this.direct&&this.sprite.finishAction(this)}}),Kaya.Utilities.extend(Kaya.Action.prototype,ScheduleMethods),Kaya.Action.Timing=Kaya.Action.extend({run:function(){this._super.apply(this,arguments),this.timer=0},refresh:function(t,i){this._super.apply(this,arguments),i?this.timer=i:this.timer+=t}}),Kaya.Action.Ease=Kaya.Action.Timing.extend({constructor:function(t,i,e){if(this._super.apply(this,arguments),4!=i.length)throw new Error("Ease action must contain 2 Bezier control point.");this.bezierAt=Kaya.Utilities.bezier(i[0],i[1],i[2],i[3],1/60/4),this._action=t,e&&(this.length=e)},run:function(){if(this._super.apply(this,arguments),this._action.run(this.sprite),!this.length){if(!this._action.length)throw new Error("Length of time is not defined for ease action.");this.length=this._action.length}},refresh:function(){return this._super.apply(this,arguments),this.timer>=this.length?(this._action.refresh(0,this.length),this._finish(),void 0):(this._action.refresh(0,parseInt(this.length*this.bezierAt(this.timer/this.length))),void 0)}}),Kaya.Action.EaseIn=Kaya.Action.Ease.extend({constructor:function(t,i){this._super(t,[.42,0,1,1],i)}}),Kaya.Action.EaseOut=Kaya.Action.Ease.extend({constructor:function(t,i){this._super(t,[0,0,.58,1],i)}}),Kaya.Action.EaseInOut=Kaya.Action.Ease.extend({constructor:function(t,i){this._super(t,[.42,0,.58,1],i)}}),Kaya.Action.Fade=Kaya.Action.Timing.extend({constructor:function(t){this._super(t),this.target=t.target,this.duration=t.duration},run:function(t){this._super.apply(this,arguments),this.origin="undefined"!=typeof t.get("alpha")?t.get("alpha"):1,this.length=this.duration,this.update()},refresh:function(){return this._super.apply(this,arguments),this.timer>=this.length?(this.sprite.set("alpha",this.target),this._finish(),void 0):(this.update(),void 0)},update:function(){var t=this.sprite;t.set("alpha",this.origin+(this.target-this.origin)*this.timer/this.length)}}),Kaya.Action.FadeTo=Kaya.Action.Fade.extend({constructor:function(t,i){var e={target:t,duration:i};this._super(e)}}),Kaya.Action.FadeIn=Kaya.Action.Fade.extend({constructor:function(t){var i={target:1,duration:t};this._super(i)}}),Kaya.Action.FadeOut=Kaya.Action.Fade.extend({constructor:function(t){var i={target:0,duration:t};this._super(i)}}),Kaya.Action.Group=Kaya.Action.extend({constructor:function(t){this._super.apply(this,arguments),this._actionGroup=t},run:function(){this._super.apply(this,arguments),this._runAction()},_runAction:function(){var t=this;this._actionGroup.forEach(function(i){i.run(t.sprite,t._finishAction.bind(t,i))})},_finishAction:function(t){var i=this._actionGroup.indexOf(t);if(!(i>-1))throw new Error("Unable to remove finished action.");this._actionGroup.splice(i,1),0===this._actionGroup.length&&this._finish()},refresh:function(t,i){this._super.apply(this,arguments),this._actionGroup.forEach(function(e){e.refresh(t,i)})}}),Kaya.Action.Move=Kaya.Action.Timing.extend({constructor:function(t){this._super(t),this.directions={x:{},y:{}};for(var i in this.directions)this.directions[i]=t[i];t.duration&&(this.duration=t.duration)},run:function(t){this._super.apply(this,arguments);for(var i in this.directions){var e=this.directions[i];e.origin=t.get(i),"undefined"==typeof e.target?"undefined"!=typeof e.distance&&(e.target=e.origin+e.distance):e.distance=e.target-e.origin}this.duration&&(this.length=this.duration),this.update()},update:function(){var t=this.sprite;for(var i in this.directions)if(this.directions.hasOwnProperty(i)){var e=this.directions[i];t.set(i,e.origin+e.distance/this.length*this.timer)}},refresh:function(){this._super.apply(this,arguments);var t=this.sprite;return this.timer>=this.length?(t.set("x",this.directions.x.target),t.set("y",this.directions.y.target),this._finish(),void 0):(this.update(),void 0)}}),Kaya.Action.MoveTo=Kaya.Action.Move.extend({constructor:function(t,i,e){var n={x:{target:t},y:{target:i},duration:e};this._super(n)}}),Kaya.Action.MoveBy=Kaya.Action.Move.extend({constructor:function(t,i,e){var n={x:{distance:t},y:{distance:i},duration:e};this._super(n)}}),Kaya.Action.Queue=Kaya.Action.Timing.extend({constructor:function(t){this._super.apply(this,arguments),this._actions=t},run:function(){this._super.apply(this,arguments),this._actionQueue=Kaya.Utilities.clone(this._actions),this._runAction()},_runAction:function(){this._actionQueue.length>0?(this._currentAction=this._actionQueue.shift(),this._currentAction.run(this.sprite,this._runAction.bind(this)),this._start=this.timer):this._finish()},refresh:function(t,i){this._super.apply(this,arguments),i?this._currentAction.refresh(0,i-this._start):this._currentAction.refresh(t)}}),Kaya.Action.Remove=Kaya.Action.extend({run:function(t){t.remove(),this._finish()}}),Kaya.Action.Repeat=Kaya.Action.extend({constructor:function(t,i){this._action=t,this._times=i},run:function(){this._super.apply(this,arguments),this._times--,this._action.run(this.sprite,this._finishAction.bind(this))},_finishAction:function(){return 0===this._times?(this._finish(),void 0):(this._times>0&&this._times--,this._action.run(this.sprite,this._finishAction.bind(this)),void 0)},refresh:function(t){this._super.apply(this,arguments),this._action.refresh(t)}}),Kaya.Action.Forever=Kaya.Action.Repeat.extend({constructor:function(t){this._super(t,-1)}}),Kaya.Action.Rotate=Kaya.Action.Timing.extend({constructor:function(t){this._super(t),t.hasOwnProperty("target")?this.target=t.target:this.distance=t.distance,this.duration=t.duration},run:function(t){this._super.apply(this,arguments),this.hasOwnProperty("target")||("undefined"!=typeof t.get("rotate")&&(this.target=this.distance+t.get("rotate")),this.target=this.distance),this.origin="undefined"!=typeof t.get("rotate")?t.get("rotate"):0,this.length=this.duration,this.update()},refresh:function(){return this._super.apply(this,arguments),this.timer>=this.length?(this.sprite.set("rotate",this.target),this._finish(),void 0):(this.update(),void 0)},update:function(){var t=this.sprite;t.set("rotate",this.origin+(this.target-this.origin)*this.timer/this.length)}}),Kaya.Action.RotateTo=Kaya.Action.Rotate.extend({constructor:function(t,i){var e={target:t,duration:i};this._super(e)}}),Kaya.Action.RotateBy=Kaya.Action.Rotate.extend({constructor:function(t,i){var e={distance:t,duration:i};this._super(e)}}),Kaya.Action.Scale=Kaya.Action.Timing.extend({constructor:function(t){this._super(t),this.orientations={width:{},height:{}};for(var i in this.orientations)this.orientations[i]=t[i];t.duration&&(this.duration=t.duration)},run:function(t){this._super.apply(this,arguments);for(var i in this.orientations){var e=this.orientations[i];e.origin=t.get(i),"undefined"==typeof e.target?"undefined"!=typeof e.distance&&(e.target=e.origin+e.distance):e.distance=e.target-e.origin}this.duration&&(this.length=this.duration),this.update()},update:function(){var t=this.sprite;for(var i in this.orientations)if(this.orientations.hasOwnProperty(i)){var e=this.orientations[i];t.set(i,e.origin+e.distance/this.length*this.timer)}},refresh:function(){this._super.apply(this,arguments);var t=this.sprite;return this.timer>=this.length?(t.set("width",this.orientations.width.target),t.set("height",this.orientations.height.target),this._finish(),void 0):(this.update(),void 0)}}),Kaya.Action.ScaleTo=Kaya.Action.Scale.extend({constructor:function(t,i,e){var n={width:{target:t},height:{target:i},duration:e};this._super(n)}}),Kaya.Action.ScaleBy=Kaya.Action.Scale.extend({constructor:function(t,i,e){var n={width:{distance:t},height:{distance:i},duration:e};this._super(n)}});